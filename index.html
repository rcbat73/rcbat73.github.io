<!DOCTYPE html>
<html lang="en">
	<head>
		<title>AR.js test</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
		<script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
		<script src="js/gesture-detector.js"></script>
    	<script src="js/gesture-handler.js"></script>
	</head>
	  
	<body>
		<script>
			/* AFRAME.registerComponent('raycaster-listen', {
				init: function () {
					console.log(this.el);
					this.el.addEventListener('click', function (evt) {					
						console.log('I was clicked at: ', evt);
					});					
				}
			}); */
			AFRAME.registerComponent('raycaster-listen', {
				init: function () {					
				// Use events to figure out what raycaster is listening so we don't have to
				// hardcode the raycaster.
					this.el.addEventListener('raycaster-intersected', evt => {
						this.raycaster = evt.detail.el;
						const walker = document.querySelector('#walker');
						const raycaster = this.raycaster;
						this.raycaster.addEventListener('click', () => {
							walker.setAttribute('position', raycaster.components.cursor.intersection.point);
						});
					});
					this.el.addEventListener('raycaster-intersected-cleared', evt => {
						this.raycaster = null;
					});					
				},
				tick: function () {
					if (!this.raycaster) { return; }  // Not intersecting.

					let intersection = this.raycaster.components.raycaster.getIntersection(this.el);
					if (!intersection) { return; }
					console.log(intersection.point);
					const cursor = document.querySelector('#cursor');
					cursor.setAttribute('position', event.detail.intersections[0].point);
				}
			});
		</script>
		<a-scene
			arjs
			embedded
			renderer="logarithmicDepthBuffer: true;"
			vr-mode-ui="enabled: false"
			gesture-detector
			id="scene"
			cursor-listener
		>
			<a-assets>
				<a-asset id="cesium-man" src="CesiumMan.glb"></a-asset>
			</a-assets>
			<a-entity
				id="walker"
				gltf-model="#cesium-man"
				position="0 0 -5"
				scale="0.5 0.5 0.5"
				animation-mixer
				gesture-handler
				
			>
			</a-entity>	
			<a-entity camera raycaster="objects: .clickable" cursor="fuse:false"></a-entity>
			<a-ring id="cursor" class="clickable" radius-inner="0.1" radius-outer="0.2"  
					color="teal" position="0 -0.8 -5" rotation="-90 0 0" raycaster-listen>
			</a-ring>		  
		</a-scene>
		<!-- <script type="text/javascript">
			function onSceneLoaded() {
				const scene = document.querySelector('a-scene');
	  
			  const walker = document.querySelector('#walker');
			  const { stringify } = AFRAME.utils.coordinates;
	  
			  let firstTime = true;
			  scene.addEventListener('click', () => {
				const target = raycaster.components.cursor.intersection.point;
	  
				if (firstTime) {
				  walker.setAttribute('position', target);
				  firstTime = false;
				} else {
				  const currentPosition = walker.object3D.position;
				  const distance = currentPosition.distanceTo(target);
	  
				  walker.object3D.lookAt(target);
	  
				  const animation = document.createElement('a-animation');
				  animation.setAttribute('attribute', 'position');
				  animation.setAttribute('to', stringify(target));
				  animation.setAttribute('dur', distance * 7000);
				  animation.setAttribute('easing', 'linear');
				  walker.appendChild(animation);
				}
			  });
			}
	  
			const scene = document.querySelector('a-scene');
			scene.addEventListener('loaded', onSceneLoaded);
		  </script> -->
	</body>
</html>

<!-- <!DOCTYPE html>
<html>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script>
    window.onload = function () {
      document
        .querySelector(".say-hi-button")
        .addEventListener("click", function () {
          alert("Hi there!");
        });
    };
  </script>
  <style>
    .buttons {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 5em;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .say-hi-button {
      padding: 0.25em;
      border-radius: 4px;
      border: none;
      background: white;
      color: black;
      width: 4em;
      height: 2em;
    }
  </style>
  <body style="margin : 0px; overflow: hidden;">
    <div class="buttons">
      <button class="say-hi-button">SAY HI!</button>
    </div>
    <a-scene embedded arjs>
        <a-entity
          position="0 0 0"
          scale="0.05 0.05 0.05"
          gltf-model="knight.glb"
        ></a-entity>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html> -->
